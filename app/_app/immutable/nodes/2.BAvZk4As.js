import{f as S,a as i,c as $,t as Ae}from"../chunks/i8dQ-dBR.js";import{o as la}from"../chunks/Wk_52NqR.js";import{h as Me,aq as ia,i as ve,ar as ca,y as ua,a1 as va,as as fa,W as da,X as pa,at as n,au as D,_ as p,Y as f,R as a,aa as _e,Z as d,K as I,M as j,av as ha}from"../chunks/UdhbeSFP.js";import{d as ga,s as H}from"../chunks/DFJnfZUh.js";import{i as b}from"../chunks/CN2NShuf.js";import{r as Oe,s as ye}from"../chunks/CCuJiZvU.js";function ma(e,t,r){var s=e==null?"":""+e;return s=s?s+" "+t:t,s===""?null:s}function Be(e,t,r,s,o,l){var g=e.__className;if(Me||g!==r||g===void 0){var _=ma(r,s);(!Me||_!==e.getAttribute("class"))&&(_==null?e.removeAttribute("class"):e.className=_),e.__className=r}return l}function Ue(e,t,r=t){var s=new WeakSet;ia(e,"input",async o=>{var l=o?e.defaultValue:e.value;if(l=Le(e)?Ne(l):l,r(l),ve!==null&&s.add(ve),await ca(),l!==(l=t())){var g=e.selectionStart,_=e.selectionEnd,E=e.value.length;if(e.value=l??"",_!==null){var u=e.value.length;g===_&&_===E&&u>E?(e.selectionStart=u,e.selectionEnd=u):(e.selectionStart=g,e.selectionEnd=Math.min(_,u))}}}),(Me&&e.defaultValue!==e.value||ua(t)==null&&e.value)&&(r(Le(e)?Ne(e.value):e.value),ve!==null&&s.add(ve)),va(()=>{var o=t();if(e===document.activeElement){var l=fa??ve;if(s.has(l))return}Le(e)&&o===Ne(e.value)||e.type==="date"&&!o&&!e.value||o!==e.value&&(e.value=o??"")})}function Le(e){var t=e.type;return t==="number"||t==="range"}function Ne(e){return e===""?null:+e}const $e="341090396774-ikenan91a247k0q9oq008r46l86r3ep5.apps.googleusercontent.com",_a="https://www.googleapis.com/auth/drive.file",Fe="yournal.txt";let T=null,k=null;const fe="yournal_file_id";function ya(){return new Promise((e,t)=>{if($e.includes("PASTE_YOUR")){t(new Error("Google Client ID not configured. See docs/GOOGLE_SETUP.md"));return}const r=window.location.hash;if(r&&r.includes("access_token")){const l=new URLSearchParams(r.substring(1)).get("access_token");l&&(T=l,window.history.replaceState(null,"",window.location.pathname),console.log("Token received from redirect"))}const s=sessionStorage.getItem("yournal_token");s&&!T&&(T=s,console.log("Token restored from session")),e()})}function wa(){let e=window.location.origin+window.location.pathname;e=e.replace(/\/$/,""),console.log("Redirect URI:",e);const t=new URL("https://accounts.google.com/o/oauth2/v2/auth");t.searchParams.set("client_id",$e),t.searchParams.set("redirect_uri",e),t.searchParams.set("response_type","token"),t.searchParams.set("scope",_a),t.searchParams.set("include_granted_scopes","true"),t.searchParams.set("prompt","consent"),window.location.href=t.toString()}function ba(){T=null,k=null,sessionStorage.removeItem("yournal_token"),localStorage.removeItem(fe),console.log("Signed out")}function Sa(){return T!==null}function ka(){T&&sessionStorage.setItem("yournal_token",T)}async function Ye(){if(k)return console.log("ğŸ“‚ Using memory-cached file ID:",k),k;const e=localStorage.getItem(fe);if(e)return console.log("ğŸ“‚ Using localStorage-cached file ID:",e),k=e,k;console.log("ğŸ” Searching for file:",Fe);const t=await fetch(`https://www.googleapis.com/drive/v3/files?q=name='${Fe}'&spaces=drive&fields=files(id,name)`,{headers:{Authorization:`Bearer ${T}`}});if(!t.ok)throw new Error(`Drive search failed: ${t.status}`);const r=await t.json();if(console.log("Search result:",r),r.files&&r.files.length>0)return r.files.length>1&&console.warn("âš ï¸ Multiple files found! Using first one. Files:",r.files),k=r.files[0].id,localStorage.setItem(fe,k),console.log("âœ… Found existing file:",k),k;const s={name:Fe,mimeType:"text/plain"},o=await fetch("https://www.googleapis.com/drive/v3/files",{method:"POST",headers:{Authorization:`Bearer ${T}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(!o.ok)throw new Error(`Drive create failed: ${o.status}`);return k=(await o.json()).id,localStorage.setItem(fe,k),console.log("âœ… Created new file:",k),k}async function Ea(e){if(!T)throw new Error("Not signed in");const t=await Ye(),r=await fetch(`https://www.googleapis.com/upload/drive/v3/files/${t}?uploadType=media`,{method:"PATCH",headers:{Authorization:`Bearer ${T}`,"Content-Type":"text/plain"},body:e});if(!r.ok)throw new Error(`Drive save failed: ${r.status}`);console.log("Saved to Drive")}async function xa(){if(!T)throw new Error("Not signed in");const e=performance.now(),t=await Ye();console.log(`â±ï¸ Find file: ${Math.round(performance.now()-e)}ms`);const r=performance.now(),s=await fetch(`https://www.googleapis.com/drive/v3/files/${t}?alt=media`,{headers:{Authorization:`Bearer ${T}`}});if(console.log(`â±ï¸ Fetch response: ${Math.round(performance.now()-r)}ms`),!s.ok){if(s.status===404)return localStorage.removeItem(fe),k=null,null;throw new Error(`Drive load failed: ${s.status}`)}const o=performance.now(),l=await s.text();return console.log(`â±ï¸ Read content: ${Math.round(performance.now()-o)}ms`),console.log(`ğŸ“„ Content length: ${l.length} chars`),l}const Ke=1e5,Ta=256,Pa=16,Da=12;function Re(e){const t=new Uint8Array(e);let r="";for(let s=0;s<t.byteLength;s++)r+=String.fromCharCode(t[s]);return btoa(r)}function Ge(e){const t=atob(e),r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r.buffer}async function Je(e,t){const r=performance.now(),s=await crypto.subtle.importKey("raw",new TextEncoder().encode(e),"PBKDF2",!1,["deriveKey"]),o=await crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:Ke,hash:"SHA-256"},s,{name:"AES-GCM",length:Ta},!1,["encrypt","decrypt"]),l=performance.now()-r;return console.log(`ğŸ”‘ Key derivation (${Ke.toLocaleString()} iterations): ${l.toFixed(0)}ms`),o}async function Ia(e,t){const r=performance.now(),s=crypto.getRandomValues(new Uint8Array(Pa)),o=crypto.getRandomValues(new Uint8Array(Da)),l=await Je(t,s),g=performance.now(),_=new TextEncoder().encode(e),E=await crypto.subtle.encrypt({name:"AES-GCM",iv:o},l,_),u=performance.now()-g,C=performance.now()-r;return console.log(`ğŸ”’ Encryption: ${u.toFixed(1)}ms (${_.length} bytes)`),console.log(`â±ï¸ Total encrypt time: ${C.toFixed(0)}ms`),{salt:Re(s.buffer),iv:Re(o.buffer),ciphertext:Re(E),version:1}}async function Ca(e,t){const r=performance.now(),s=new Uint8Array(Ge(e.salt)),o=new Uint8Array(Ge(e.iv)),l=Ge(e.ciphertext),g=await Je(t,s),_=performance.now();try{const E=await crypto.subtle.decrypt({name:"AES-GCM",iv:o},g,l),u=performance.now()-_,C=performance.now()-r,L=new TextDecoder().decode(E);return console.log(`ğŸ”“ Decryption: ${u.toFixed(1)}ms (${L.length} chars)`),console.log(`â±ï¸ Total decrypt time: ${C.toFixed(0)}ms`),L}catch{throw new Error("Decryption failed. Wrong passphrase?")}}function Aa(e){try{const t=JSON.parse(e);return t&&typeof t.salt=="string"&&typeof t.iv=="string"&&typeof t.ciphertext=="string"&&typeof t.version=="number"}catch{return!1}}function Ua(e){return JSON.parse(e)}function La(e){return JSON.stringify(e)}var Na=S('<section class="loading-state svelte-1uha8ag"><div class="spinner svelte-1uha8ag"></div> <p>Loading...</p></section>'),Fa=S('<section class="error-state svelte-1uha8ag"><p class="error-icon svelte-1uha8ag">âš ï¸</p> <p class="error-message svelte-1uha8ag"> </p> <button class="primary svelte-1uha8ag">Retry</button></section>'),Ra=S('<section class="auth svelte-1uha8ag"><div class="auth-icon svelte-1uha8ag">ğŸ”</div> <p class="svelte-1uha8ag">Sign in with Google to save your encrypted journal to your own Google Drive.</p> <button class="google-btn svelte-1uha8ag">Sign in with Google</button> <div class="features svelte-1uha8ag"><div class="feature svelte-1uha8ag"><span class="feature-icon svelte-1uha8ag">ğŸ”’</span> <span>End-to-end encrypted</span></div> <div class="feature svelte-1uha8ag"><span class="feature-icon svelte-1uha8ag">â˜ï¸</span> <span>Stored in your Drive</span></div> <div class="feature svelte-1uha8ag"><span class="feature-icon svelte-1uha8ag">ğŸ‘ï¸â€ğŸ—¨ï¸</span> <span>Zero-knowledge</span></div></div></section>'),Ga=S(`<div class="warning svelte-1uha8ag"><strong>âš ï¸ Important:</strong> Your passphrase cannot be recovered. 
					If you forget it, your data is lost forever. Choose something memorable but secure.</div>`),Ma=S('<p class="hint error svelte-1uha8ag">Passphrase must be at least 8 characters</p>'),Oa=S(`<p class="hint error svelte-1uha8ag">Passphrases don't match</p>`),Ba=S('<p class="hint success svelte-1uha8ag">âœ“ Passphrases match</p>'),Ka=S('<div class="input-group svelte-1uha8ag"><label for="confirmPassphrase" class="svelte-1uha8ag">Confirm Passphrase</label> <input id="confirmPassphrase" placeholder="Type it again to confirm" class="svelte-1uha8ag"/></div> <!>',1),$a=S('<span class="btn-spinner svelte-1uha8ag"></span> Decrypting...',1),Ya=S("<p> </p>"),Ja=S('<section class="user-bar svelte-1uha8ag"><span class="signed-in svelte-1uha8ag">â— Connected to Drive</span> <button class="sign-out svelte-1uha8ag">Sign out</button></section> <section class="passphrase-form svelte-1uha8ag"><h2 class="svelte-1uha8ag"> </h2> <!> <div class="input-group svelte-1uha8ag"><label for="passphrase" class="svelte-1uha8ag"> </label> <div class="password-input svelte-1uha8ag"><input id="passphrase" class="svelte-1uha8ag"/> <button type="button" class="toggle-visibility svelte-1uha8ag"> </button></div></div> <!> <button class="primary unlock-btn svelte-1uha8ag"><!></button> <!></section>',1),ja=S('<span class="btn-spinner svelte-1uha8ag"></span> Saving...',1),Ha=S("<p> </p>"),Va=S('<p class="saved-time svelte-1uha8ag"> </p>'),Wa=S(`<section class="user-bar svelte-1uha8ag"><span class="unlocked svelte-1uha8ag">ğŸ”“ Unlocked</span> <button class="lock-btn svelte-1uha8ag">Lock</button></section> <section class="editor svelte-1uha8ag"><textarea placeholder="What's on your mind?" rows="14" class="svelte-1uha8ag"></textarea> <div class="editor-footer svelte-1uha8ag"><div class="actions svelte-1uha8ag"><button class="primary svelte-1uha8ag"><!></button> <button class="danger svelte-1uha8ag">Clear</button></div> <div class="meta-info svelte-1uha8ag"><!></div></div></section>`,1),qa=S('<main class="svelte-1uha8ag"><header class="svelte-1uha8ag"><h1 class="svelte-1uha8ag">Yournal</h1> <p class="tagline svelte-1uha8ag">Your private, encrypted journal</p></header> <!> <footer class="svelte-1uha8ag"><p class="svelte-1uha8ag">ğŸ” AES-256-GCM Â· PBKDF2 Â· Zero-knowledge</p></footer></main>');function tt(e,t){da(t,!0);let r=D("loading"),s=D(""),o=D(""),l=D(""),g=D(""),_=D("info"),E=D(null),u=D(!1),C=D(!1),L=D(!1),R=D(!1),Y=null;function h(v,y="info",A=3e3){n(g,v,!0),n(_,y,!0),A>0&&setTimeout(()=>{a(g)===v&&n(g,"")},A)}la(async()=>{try{await ya(),Sa()?(ka(),n(r,"locked"),n(u,!1)):n(r,"signed-out")}catch(v){console.error("Init error:",v),h(v.message,"error",0),n(r,"error")}});function je(){wa()}function He(){ba(),n(r,"signed-out"),n(s,""),n(o,""),n(l,""),Y=null,n(E,null),n(u,!1),h("Signed out","info")}async function we(){if(!a(o)){h("Please enter a passphrase","error");return}if(a(o).length<8){h("Passphrase must be at least 8 characters","error");return}n(R,!0),h("Loading...","info",0);try{const v=performance.now(),y=await xa(),A=Math.round(performance.now()-v);if(console.log(`ğŸ“¡ Network (load from Drive): ${A}ms`),!y||!y.trim()){if(!a(l)){n(u,!0),h("No existing journal. Please confirm your new passphrase.","info",0),n(R,!1);return}if(a(o)!==a(l)){h("Passphrases do not match","error"),n(R,!1);return}Y=a(o),n(o,""),n(l,""),n(s,""),n(r,"unlocked"),h("Journal created! Start writing.","success");return}if(!Aa(y))Y=a(o),n(s,y,!0),h(`Loaded legacy data (${A}ms) - will encrypt on save`,"info");else{const ae=performance.now(),Se=Ua(y),G=await Ca(Se,a(o)),M=Math.round(performance.now()-ae);Y=a(o),n(s,G,!0),h(`Unlocked! (${M}ms crypto, ${A}ms network)`,"success")}n(o,""),n(l,""),n(u,!1),n(r,"unlocked")}catch(v){const y=v.message;y.includes("Decryption failed")?h("Wrong passphrase. Please try again.","error"):h("Error: "+y,"error"),console.error(v)}finally{n(R,!1)}}function Ve(){n(r,"locked"),n(s,""),Y=null,n(E,null),h("Locked","info")}async function We(){if(!Y){h("No passphrase set","error");return}n(L,!0),h("Encrypting...","info",0);try{const v=performance.now(),y=await Ia(a(s),Y);h("Saving to Drive...","info",0);const A=La(y);await Ea(A);const ae=Math.round(performance.now()-v);n(E,new Date,!0),n(u,!1),h(`Saved in ${ae}ms`,"success")}catch(v){h("Save failed: "+v.message,"error"),console.error(v)}finally{n(L,!1)}}function qe(){confirm("Clear your note? This cannot be undone.")&&(n(s,""),h("Cleared","info"))}var be=qa(),ze=p(f(be),2);{var Ze=v=>{var y=Na();i(v,y)},Xe=v=>{var y=$(),A=I(y);{var ae=G=>{var M=Fa(),te=p(f(M),2),ke=f(te,!0);d(te);var Ee=p(te,2);Ee.__click=()=>window.location.reload(),d(M),j(()=>H(ke,a(g))),i(G,M)},Se=G=>{var M=$(),te=I(M);{var ke=V=>{var W=Ra(),xe=p(f(W),4);xe.__click=je,_e(2),d(W),i(V,W)},Ee=V=>{var W=$(),xe=I(W);{var Qe=q=>{var re=Ja(),se=I(re),Te=p(f(se),2);Te.__click=He,d(se);var z=p(se,2),Z=f(z),oe=f(Z,!0);d(Z);var de=p(Z,2);{var pe=c=>{var m=Ga();i(c,m)};b(de,c=>{a(u)&&c(pe)})}var O=p(de,2),X=f(O),ne=f(X,!0);d(X);var B=p(X,2),N=f(B);Oe(N),N.__keydown=c=>c.key==="Enter"&&!a(u)&&we();var Q=p(N,2);Q.__click=()=>n(C,!a(C));var Pe=f(Q,!0);d(Q),d(B),d(O);var le=p(O,2);{var he=c=>{var m=Ka(),P=I(m),F=p(f(P),2);Oe(F),F.__keydown=U=>U.key==="Enter"&&we(),d(P);var ce=p(P,2);{var K=U=>{var ge=Ma();i(U,ge)},ue=U=>{var ge=$(),aa=I(ge);{var ta=ee=>{var me=Oa();i(ee,me)},ra=ee=>{var me=$(),sa=I(me);{var oa=Ce=>{var na=Ba();i(Ce,na)};b(sa,Ce=>{a(o).length>=8&&a(o)===a(l)&&Ce(oa)},!0)}i(ee,me)};b(aa,ee=>{a(o).length>=8&&a(l).length>0&&a(o)!==a(l)?ee(ta):ee(ra,!1)},!0)}i(U,ge)};b(ce,U=>{a(o).length>0&&a(o).length<8?U(K):U(ue,!1)})}j(()=>{ye(F,"type",a(C)?"text":"password"),F.disabled=a(R)}),Ue(F,()=>a(l),U=>n(l,U)),i(c,m)};b(le,c=>{a(u)&&c(he)})}var J=p(le,2);J.__click=we;var De=f(J);{var Ie=c=>{var m=$a();_e(),i(c,m)},w=c=>{var m=$(),P=I(m);{var F=K=>{var ue=Ae("Create Journal");i(K,ue)},ce=K=>{var ue=Ae("Unlock");i(K,ue)};b(P,K=>{a(u)?K(F):K(ce,!1)},!0)}i(c,m)};b(De,c=>{a(R)?c(Ie):c(w,!1)})}d(J);var x=p(J,2);{var ie=c=>{var m=Ya(),P=f(m,!0);d(m),j(()=>{Be(m,1,`status ${a(_)??""}`,"svelte-1uha8ag"),H(P,a(g))}),i(c,m)};b(x,c=>{a(g)&&c(ie)})}d(z),j(()=>{H(oe,a(u)?"ğŸ†• Create Your Passphrase":"ğŸ”’ Unlock Your Journal"),H(ne,a(u)?"New Passphrase":"Passphrase"),ye(N,"type",a(C)?"text":"password"),ye(N,"placeholder",a(u)?"Create a strong passphrase":"Enter your passphrase"),N.disabled=a(R),ye(Q,"title",a(C)?"Hide passphrase":"Show passphrase"),H(Pe,a(C)?"ğŸ™ˆ":"ğŸ‘ï¸"),J.disabled=a(R)||!a(o)||a(u)&&(a(o)!==a(l)||a(o).length<8)}),Ue(N,()=>a(o),c=>n(o,c)),i(q,re)},ea=q=>{var re=$(),se=I(re);{var Te=z=>{var Z=Wa(),oe=I(Z),de=p(f(oe),2);de.__click=Ve,d(oe);var pe=p(oe,2),O=f(pe);ha(O);var X=p(O,2),ne=f(X),B=f(ne);B.__click=We;var N=f(B);{var Q=w=>{var x=ja();_e(),i(w,x)},Pe=w=>{var x=Ae("ğŸ’¾ Save");i(w,x)};b(N,w=>{a(L)?w(Q):w(Pe,!1)})}d(B);var le=p(B,2);le.__click=qe,d(ne);var he=p(ne,2),J=f(he);{var De=w=>{var x=Ha(),ie=f(x,!0);d(x),j(()=>{Be(x,1,`status ${a(_)??""}`,"svelte-1uha8ag"),H(ie,a(g))}),i(w,x)},Ie=w=>{var x=$(),ie=I(x);{var c=m=>{var P=Va(),F=f(P);d(P),j(ce=>H(F,`Last saved: ${ce??""}`),[()=>a(E).toLocaleTimeString()]),i(m,P)};b(ie,m=>{a(E)&&m(c)},!0)}i(w,x)};b(J,w=>{a(g)?w(De):w(Ie,!1)})}d(he),d(X),d(pe),j(()=>{O.disabled=a(L),B.disabled=a(L),le.disabled=a(L)}),Ue(O,()=>a(s),w=>n(s,w)),i(z,Z)};b(se,z=>{a(r)==="unlocked"&&z(Te)},!0)}i(q,re)};b(xe,q=>{a(r)==="locked"?q(Qe):q(ea,!1)},!0)}i(V,W)};b(te,V=>{a(r)==="signed-out"?V(ke):V(Ee,!1)},!0)}i(G,M)};b(A,G=>{a(r)==="error"?G(ae):G(Se,!1)},!0)}i(v,y)};b(ze,v=>{a(r)==="loading"?v(Ze):v(Xe,!1)})}_e(2),d(be),i(e,be),pa()}ga(["click","keydown"]);export{tt as component};
